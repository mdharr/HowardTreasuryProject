<div *ngIf="!isLoaded" class="spinner-wrapper">
  <div class="spinner-box">
    <mat-spinner></mat-spinner>
  </div>
</div>
<div *ngIf="isLoaded">
  <div class="title-container">
    <h1 class="story-title">{{ story.title }}</h1>
    <p *ngIf="story.description" class="description-text">{{ story.description }}</p>
  </div>

  <div class="collection-container">
    <div class="collection-title-box">
      <div class="title-box">
        <h2 class="collection-title">Collections</h2>
      </div>
      <b class="b-element"></b>
      <div class="flair-wrapper">
        <img class="flair-img" src="http://www.barbariankeep.com/LSWORD.GIF" alt="">
      </div>
    </div>
    <div class="collection-box" *ngIf="story.collections.length">
      <ng-container *ngFor="let collection of story.collections">
        <div class="collection-wrapper" [routerLink]="['/collections', collection.id]">
          <img class="collection-images" src="{{ collection.collectionImages[0].imageUrl }}" alt="">
        </div>
      </ng-container>
    </div>

  </div>

  <div class="description-container">
    <div>
      <div class="description-title-box">
        <div class="title-box">
          <h2 class="description-title">Excerpt</h2>
        </div>
        <b class="b-element"></b>
        <div class="flair-wrapper">
          <img class="flair-img" src="http://www.barbariankeep.com/LSWORD.GIF" alt="">
        </div>
      </div>
      <div class="excerpt-box" *ngIf="story.excerpt">
        <p class="excerpt-text" [innerHTML]="storyExcerpt"></p><span class="read-online-box" *ngIf="story.textUrl"><a class="story-text-link" href="{{ story.textUrl }}">Continue reading</a></span>
        <!-- <hr> -->
      </div>
      <div class="excerpt-box" style="justify-content:flex-start; margin:20px;" *ngIf="!story.excerpt">
        <p class="excerpt-text">Excerpt not yet available.</p><span class="read-online-box" *ngIf="story.textUrl"><a class="story-text-link" href="{{ story.textUrl }}">Continue reading</a></span>
        <!-- <hr> -->
      </div>
    </div>

    <!-- <div class="description-container">
      <div class="description-title-box">
        <div class="title-box">
          <h2 class="description-title">Description</h2>
        </div>
        <b class="b-element"></b>
        <div class="flair-wrapper">
          <img class="flair-img" src="https://howardtreasury.s3.amazonaws.com/assets/siteassets/solomon-kane-flair-removebg-preview.png" alt="">
        </div>
      </div>
      <div class="description-box" *ngIf="story.description">
        <p class="description-text">{{ story.description }}</p>
      </div>
      <div class="description-box" style="justify-content:flex-start; margin:20px;" *ngIf="!story.description">
        <p class="description-text">Description not yet available.</p>
      </div>

    </div> -->

    <div class="description-container">
      <div class="description-title-box">
        <div class="title-box">
          <h2 class="description-title">Artwork</h2>
        </div>
        <b class="b-element"></b>
        <div class="flair-wrapper">
          <img class="flair-img" src="http://www.barbariankeep.com/LSWORD.GIF" alt="">
        </div>
      </div>
      <div class="story-image-box" *ngIf="storyImages && imagesLoaded">
        <ng-container *ngFor="let storyImage of storyImages; let i = index">
          <img class="story-image shine" src="{{ storyImage.imageUrl }}" (click)="openLightbox(i, $event)" loading="lazy">
        </ng-container>
      </div>
      <div *ngIf="!imagesLoaded" class="image-spinner-wrapper">
        <div class="image-spinner-box">
          <mat-spinner></mat-spinner>
        </div>
      </div>

      <div class="story-image-box" *ngIf="!storyImages">
        <p class="description-text">Artwork not yet available.</p>
        <!-- <hr> -->
      </div>

    </div>
    <hr>

    <div class="story-details">
      <div class="details-wrapper">
        <div>
          <p>First published in {{ story.firstPublished | date:'yyyy' }}</p>
        </div>
        <div>
          <p>Copyright status: {{ story.isCopyrighted === true ? 'Under copyright until ' + (story.copyrightExpiresAt | date:'mediumDate') + '.' : 'No longer under copyright.' }}</p>
        </div>
        <div>
          <p>Appears in the following collection(s):
            <ng-container *ngFor="let collection of storyCollections; let lastIndex = last; let firstIndex = first">
              <span class="collection-link" [routerLink]="['/collections', collection.id]">
                {{ firstIndex && !lastIndex ? (collection.title + ', ') : firstIndex && lastIndex ? (collection.title) : !firstIndex && !lastIndex ? (collection.title + ', ') : (collection.title) }}
              </span>
            </ng-container>
          </p>
        </div>
        <div>
          <p>Recurring characters:
            <ng-container *ngFor="let person of story.persons; let lastIndex = last; let firstIndex = first">
              <span class="collection-link" [routerLink]="['/characters', person.id]">
                {{ firstIndex && !lastIndex ? (person.name + ', ') : firstIndex && lastIndex ? (person.name) : !firstIndex && !lastIndex ? (person.name + ', ') : (person.name) }}
              </span>
            </ng-container>
          </p>
        </div>
      </div>
    </div>
  </div>

</div>

<!-- <div class="lightbox" *ngIf="showLightbox">
  <div class="lightbox-content">
    <img src="{{ selectedImage.imageUrl }}" class="lightbox-image" (click)="onLightboxImageClick($event)">
    <div class="lightbox-controls">
      <div class="control download-icon" (click)="downloadImage(selectedImage)">&#8681;</div>
      <div class="control close-icon" (click)="closeLightbox()">&#10006;</div>
    </div>
    <div class="lightbox-image-count">{{ currentIndex + 1 }} of {{ storyImages.length }}</div>
  </div>
  <div class="lightbox-thumbnails">
    <div class="thumbnails-container" [style.transform]="'translateX(' + getThumbnailTransform() + 'px)'">
      <ng-container *ngFor="let storyImage of storyImages; let i = index">
        <div class="thumbnail-text">{{ i + 1 }}</div>
        <div
          class="thumbnail"
          [class.selected]="i === selectedThumbnailIndex"
          (click)="selectImage(i)"
        >
          <img src="{{ storyImage.imageUrl }}" class="thumbnail-image">
        </div>
      </ng-container>
    </div>
  </div>
</div> -->

<div class="lightbox" *ngIf="showLightbox">
  <div class="lightbox-content">
    <div class="lightbox-image-container">
      <img src="{{ selectedImage.imageUrl }}" class="lightbox-image" (click)="onLightboxImageClick($event)">
    </div>
    <div class="lightbox-controls" (click)="$event.stopPropagation()">
      <div class="control download-icon" (click)="downloadImage(selectedImage)">&#8681;</div>
      <div class="control close-icon" (click)="closeLightbox()">&#10006;</div>
    </div>
    <div class="lightbox-image-count">{{ currentIndex + 1 }} of {{ storyImages.length }}</div>
  </div>
  <div class="lightbox-thumbnails" (click)="$event.stopPropagation()">
    <div class="thumbnails-container" [style.transform]="'translateX(' + getThumbnailTransform() + 'px)'">
      <ng-container *ngFor="let storyImage of storyImages; let i = index">
        <div class="thumbnail-text">{{ i + 1 }}</div>
        <div
          class="thumbnail"
          [class.selected]="i === selectedThumbnailIndex"
          (click)="selectImage(i)"
        >
          <img src="{{ storyImage.imageUrl }}" class="thumbnail-image">
        </div>
      </ng-container>
    </div>
  </div>
</div>

